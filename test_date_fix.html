<!DOCTYPE html>
<html>
<head>
    <title>Date Loop Test - Before vs After Fix</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .section { margin: 30px 0; padding: 20px; background: #f5f5f5; border-radius: 8px; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        table { border-collapse: collapse; margin: 10px 0; }
        td, th { padding: 8px; border: 1px solid #ddd; text-align: left; }
        th { background: #333; color: white; }
    </style>
</head>
<body>
    <h1>Date Loop Test: Verifying Calendar Fix</h1>

    <div class="section">
        <h2>‚ùå BEFORE (BUGGY CODE):</h2>
        <pre>const date = new Date(startDate);
date.setDate(startDate.getDate() + i);</pre>
        <p><span class="error">BUG:</span> Uses startDate.getDate() instead of date.getDate()</p>
        
        <table>
            <tr><th>i</th><th>Expected Date</th><th>Buggy Result</th><th>Status</th></tr>
            <script>
                const startDateBuggy = new Date(2025, 10, 1); // Nov 1, 2025
                startDateBuggy.setDate(startDateBuggy.getDate() - startDateBuggy.getDay()); // Go to Sunday before
                
                for (let i = 0; i < 7; i++) {
                    const expected = new Date(startDateBuggy.getTime());
                    expected.setDate(expected.getDate() + i);
                    
                    // Simulate buggy code
                    const buggy = new Date(startDateBuggy);
                    buggy.setDate(startDateBuggy.getDate() + i); // BUG: uses startDateBuggy.getDate()
                    
                    const match = expected.toDateString() === buggy.toDateString();
                    const status = match ? '‚úì' : '‚úó';
                    const expectedStr = expected.toISOString().split('T')[0];
                    const buggyStr = buggy.toISOString().split('T')[0];
                    
                    document.write(`<tr><td>${i}</td><td>${expectedStr}</td><td class="${match ? 'success' : 'error'}">${buggyStr}</td><td>${status}</td></tr>`);
                }
            </script>
        </table>
    </div>

    <div class="section">
        <h2>‚úÖ AFTER (FIXED CODE):</h2>
        <pre>const date = new Date(startDate.getTime());
date.setDate(date.getDate() + i);</pre>
        <p><span class="success">FIXED:</span> Uses date.getDate() with proper Date object clone</p>
        
        <table>
            <tr><th>i</th><th>Expected Date</th><th>Fixed Result</th><th>Status</th></tr>
            <script>
                const startDateFixed = new Date(2025, 10, 1); // Nov 1, 2025
                startDateFixed.setDate(startDateFixed.getDate() - startDateFixed.getDay());
                
                for (let i = 0; i < 7; i++) {
                    const expected = new Date(startDateFixed.getTime());
                    expected.setDate(expected.getDate() + i);
                    
                    // Fixed code
                    const fixed = new Date(startDateFixed.getTime()); // Clone using getTime()
                    fixed.setDate(fixed.getDate() + i); // Uses fixed.getDate()
                    
                    const match = expected.toDateString() === fixed.toDateString();
                    const status = match ? '‚úì' : '‚úó';
                    const expectedStr = expected.toISOString().split('T')[0];
                    const fixedStr = fixed.toISOString().split('T')[0];
                    
                    document.write(`<tr><td>${i}</td><td>${expectedStr}</td><td class="${match ? 'success' : 'error'}">${fixedStr}</td><td>${status}</td></tr>`);
                }
            </script>
        </table>
    </div>

    <div class="section">
        <h2>üéØ Expected November 2025 First Week:</h2>
        <table>
            <tr><th>Day</th><th>Date</th><th>Should Highlight?</th></tr>
            <script>
                const availableDates = ["2025-11-01", "2025-11-02", "2025-11-03", "2025-11-04", "2025-11-05", "2025-11-06", "2025-11-07", "2025-11-08", "2025-11-09", "2025-11-10", "2025-11-11", "2025-11-12", "2025-11-13", "2025-11-14", "2025-11-23", "2025-11-30"];
                
                const nov1 = new Date(2025, 10, 1);
                const sunday = new Date(nov1);
                sunday.setDate(sunday.getDate() - nov1.getDay());
                
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                
                for (let i = 0; i < 7; i++) {
                    const date = new Date(sunday.getTime());
                    date.setDate(date.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    const shouldHighlight = availableDates.includes(dateStr) ? 'üü¢ YES' : '‚ö™ NO';
                    
                    document.write(`<tr><td>${days[i]}</td><td>${dateStr}</td><td>${shouldHighlight}</td></tr>`);
                }
            </script>
        </table>
        <p><strong>Note:</strong> November 1, 2025 is a Saturday, so the week starts on October 26 (Sunday).</p>
    </div>

    <script>
        console.log('November 1, 2025 info:');
        const nov1 = new Date(2025, 10, 1);
        console.log('Day of week:', nov1.getDay(), '(0=Sun, 6=Sat)');
        console.log('ISO Date:', nov1.toISOString().split('T')[0]);
    </script>
</body>
</html>
